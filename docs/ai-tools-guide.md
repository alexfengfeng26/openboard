# AI 工具调用功能使用手册

本手册介绍如何使用看板系统的 AI 工具调用功能，通过自然语言指令管理看板、列表和卡片。

---

## 功能概述

AI 工具调用允许你通过对话方式执行看板操作：

- **创建**：创建卡片、列表或看板
- **更新**：修改卡片标题、描述，或移动到其他列表
- **删除**：删除卡片、列表或看板

---

## 使用方式

### 1. 打开 AI 聊天面板

点击右侧 **"Chat"** 按钮打开 AI 对话面板。

### 2. 输入自然语言指令

在输入框中直接描述你想要的操作，例如：

```
创建一张卡片：优化登录功能
帮我生成 3 张待办任务
把卡片"修复登录 bug"移到"进行中"列表
删除卡片 card-12345
```

### 3. 确认执行

AI 会将你的指令转换为工具调用，并在执行前显示**确认对话框**，包含：

- 操作类型（创建卡片、删除卡片等）
- 具体参数（如标题、列表 ID 等）
- 目标描述

点击**"确认执行"** 按钮后执行操作。

### 4. 查看操作日志

点击聊天面板中的 **"日志(X)"** 按钮可以打开操作历史记录，查看：

- 执行时间
- 操作类型
- 执行结果（成功/失败）
- 详细参数

---

## 支持的操作

### 卡片操作

| 操作 | 示例指令 |
|------|----------|
| 创建卡片 | `创建一张卡片：测试功能` |
| 更新卡片 | `更新卡片 card-123：修改标题为新的标题` |
| 删除卡片 | `删除卡片 card-123` |
| 移动卡片 | `把卡片 card-1 移到进行中列表` |

### 列表操作

| 操作 | 示例指令 |
|------|----------|
| 创建列表 | `创建一个新列表叫"测试列表"` |
| 删除列表 | `删除列表"待办列表"` |

### 看板操作

| 操作 | 示例指令 |
|------|----------|
| 创建看板 | `创建一个新的看板叫"项目 A"` |
| 删除看板 | `删除看板"项目 A"` |

---

## 快捷指令

点击输入框下方的快捷按钮可以快速填充常用指令：

- **生成待办任务**：快速创建待办类型卡片
- **拆分为子任务**：将需求拆解为多张卡片
- **总结为卡片**：将内容总结为单张卡片

---

## 注意事项

1. **上下文感知**：AI 自动获取当前看板和列表信息，你可以直接使用列表名称（如"移到进行中"）而无需记住 ID

2. **执行前确认**：所有修改操作都会显示确认对话框，防止误操作

3. **操作记录**：所有操作都会记录在日志中，方便追溯和审计

4. **多看板支持**：可以在不同看板间切换，工具调用会自动使用当前看板的上下文

---

## 技术说明

### 工具调用流程

```
用户输入 → 构建系统提示词（包含工具定义）→ DeepSeek API
→ 返回 JSON 格式工具调用 → 解析工具调用 → 显示确认对话框
→ 用户确认 → 调用服务端 API → 执行数据库操作 → 更新看板 UI
```

### 客户端/服务端分离

- **客户端**：负责 UI 展示、用户交互、工具调用解析
- **服务端**：负责执行实际数据库操作，确保客户端无法直接访问敏感数据

---

## 常见问题

**Q: AI 返回了普通文字而不是工具调用？**
A: 确保你的指令包含明确的操作意图，如"创建"、"删除"、"更新"等关键词。

**Q: 确认对话框显示的参数不正确？**
A: 点击取消后可以重新输入指令。如果参数自动识别有误，可以手动指定正确的列表名称或卡片 ID。

**Q: 操作执行失败了？**
A: 查看操作日志获取详细错误信息，检查输入的 ID 是否正确。

**Q: 如何在多个看板间使用？**
A: 使用看板选择器切换目标看板，AI 工具会自动使用当前看板的上下文。

**Q: 可以同时执行多个操作吗？**
A: 可以在一次对话中描述多个操作，AI 会为每个操作生成独立的工具调用并依次执行。

---

## 最佳实践

1. **明确具体**：描述操作时尽量具体，如"在'进行中'列表创建一张标题为'优化登录体验'的卡片"而非"创建卡片"

2. **使用列表名称**：可以直接使用列表的显示名称（如"待办"、"进行中"）而无需记忆 ID

3. **批量操作**：可以在一条指令中描述多个操作，如"创建张卡片 A，再创建张卡片 B"

4. **检查日志**：操作失败时先查看日志了解具体原因

---

## 更新日志

- **v1.0.0** - 2025-02-11：初始版本
- **v1.1.0** - 2025-02-11：AI 工具调用功能完整实现

### 新增功能
- 工具定义系统：10 种工具（卡片/列表/看板 CRUD）
- 用户确认机制：防止误操作
- 操作日志面板：完整记录和追溯
- 客户端/服务端分离：提升安全性和可维护性

---

## 附录

### 文件结构

新增的 AI 工具系统文件：
- `lib/ai-tools/` - 工具定义和执行器
- `app/api/ai/tools/execute/route.ts` - 工具执行 API
- `components/ai/` - AI 相关 UI 组件

### 技术实现

- **Prompt 构建器**：动态生成包含工具定义的系统提示词
- **工具调用解析器**：从 AI 响应中提取结构化工具调用
- **服务端执行器**：通过 dbHelpers 执行实际数据库操作
